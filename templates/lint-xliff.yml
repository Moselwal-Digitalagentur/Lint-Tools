spec:
  inputs:
    stage:
      default: 'lint'
---
lint:xliff:
  stage: $[[ inputs.stage ]]
  image: $PHP_IMAGE
  needs: []
  rules:
    - if: $CI_COMMIT_TAG
      when: never
    - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
    - if: $CI_COMMIT_REF_NAME != 'release'
    - if: $CI_COMMIT_REF_NAME == 'release'
      when: never
  allow_failure: false
  tags:
    - docker
  before_script:
    - echo "Downloading XLIFF Schema"
    - wget --no-check-certificate https://docs.oasis-open.org/xliff/v1.2/os/xliff-core-1.2-strict.xsd && mv xliff-core-1.2-strict.xsd /
  script:
    - echo "Checking for XLIFF files"
    - |
      if [ ! -d "Resources/Private/Language/" ]; then
        echo "No Resources/Private/Language/ directory found. Job will terminate successfully."
        exit 0
      fi
      xliff_files=$(find Resources/Private/Language/ -name '*.xlf')
      if [ -z "$xliff_files" ]; then
        echo "No XLIFF files found. Job will terminate successfully."
        exit 0
      fi
      echo "Running XLIFF Lint"
      xmllint --schema /xliff-core-1.2-strict.xsd --noout $xliff_files